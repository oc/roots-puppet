<!DOCTYPE html>
<!--
  Copyright 2010 Google Inc.

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

     http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.

  Original slides: Marcin Wichary (mwichary@google.com)
  Modifications: Ernest Delgado (ernestd@google.com)
                 Alex Russell (slightlyoff@chromium.org)

  landslide modifications: Adam Zapletal (adamzap@gmail.com)
                           Nicolas Perriault (nperriault@gmail.com)
-->
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Declarative Configuration Management with&nbsp;Puppet</title>
    <!-- Styles -->
    
    <link rel="stylesheet" media="print" href="file:///Library/Python/2.6/site-packages/landslide/themes/default/css/print.css">
    <link rel="stylesheet" media="screen, projection" href="file:///Library/Python/2.6/site-packages/landslide/themes/light/css/screen.css">
    
    <!-- /Styles -->
    <!-- Javascripts -->
    
    <script type="text/javascript" src="file:///Library/Python/2.6/site-packages/landslide/themes/default/js/slides.js"></script>
    
    <!-- /Javascripts -->
</head>
<body>
  <div class="presentation">
    <div class="slides">
      
      <!-- slide source: slides.md -->
      <div class="slide">
        <div class="inner">
          
          <header><h1>Declarative Configuration Management with&nbsp;Puppet</h1></header>
          
          
        </div>
        <footer>
          
          <aside class="source">
            Source: <a href="file:///Users/oc/Dropbox/Shares/Roots 2011/roots-puppet/tutorial/slides.md">slides.md</a>
          </aside>
          
          <aside class="page_number">
            1/23
          </aside>
        </footer>
      </div>
      
      <!-- slide source: slides.md -->
      <div class="slide">
        <div class="inner">
          
          
          <section><blockquote>
<p>Configuration Management is a set of tool that let you describe your stack's
setup in such a way that this configuration management tool can recreate that
stack from <em>any known starting point</em>.</p>
<p>Where an automation tool like Fabric or Capistrano is <em>imperative</em>
(do this, do that, then do this), configuration management tools tends
to be <em>declarative</em>.</p>
<p>You say: &ldquo;I have a server and it runs MySQL as this user&rdquo; and the
configuration management tool figures out how to make that true.</p>
</blockquote>
<p>&mdash; Jacob Kaplan-Moss,
<a href="http://blog.mahalo.com/dev-blog/2011/2/15/jacob-kaplan-moss-at-mahalo.html">How I Learned To Stop Worrying and Love Deployment</a></p></section>
          
        </div>
        <footer>
          
          <aside class="source">
            Source: <a href="file:///Users/oc/Dropbox/Shares/Roots 2011/roots-puppet/tutorial/slides.md">slides.md</a>
          </aside>
          
          <aside class="page_number">
            2/23
          </aside>
        </footer>
      </div>
      
      <!-- slide source: slides.md -->
      <div class="slide">
        <div class="inner">
          
          <header><h1>Users</h1></header>
          
          
          <section><ul>
<li>Twitter</li>
<li>Digg</li>
<li>Google</li>
<li>Rackspace</li>
<li>Red Hat</li>
<li>Match.com</li>
<li>Stanford University</li>
<li>New York University</li>
</ul></section>
          
        </div>
        <footer>
          
          <aside class="source">
            Source: <a href="file:///Users/oc/Dropbox/Shares/Roots 2011/roots-puppet/tutorial/slides.md">slides.md</a>
          </aside>
          
          <aside class="page_number">
            3/23
          </aside>
        </footer>
      </div>
      
      <!-- slide source: slides.md -->
      <div class="slide has_code">
        <div class="inner">
          
          <header><h1>Preparation</h1></header>
          
          
          <section><p>Bare
    !sh yum install puppet</p>
<p>Master</p>
<div class="highlight"><pre><span class="lineno">1</span> bash &lt; &lt;<span class="o">(</span>curl -s https://github.com/oc/roots-puppet/raw/master/init-master.sh<span class="o">)</span>
</pre></div>

<p>Agent</p>
<div class="highlight"><pre><span class="lineno">1</span> bash &lt; &lt;<span class="o">(</span>curl -s https://github.com/oc/roots-puppet/raw/master/init-agent.sh<span class="o">)</span>
</pre></div>
</section>
          
        </div>
        <footer>
          
          <aside class="source">
            Source: <a href="file:///Users/oc/Dropbox/Shares/Roots 2011/roots-puppet/tutorial/slides.md">slides.md</a>
          </aside>
          
          <aside class="page_number">
            4/23
          </aside>
        </footer>
      </div>
      
      <!-- slide source: slides.md -->
      <div class="slide has_code">
        <div class="inner">
          
          <header><h1>Resources</h1></header>
          
          
          <section><p>Have <em>type</em>, <em>name</em>, and <em>parameters</em>:</p>
<div class="highlight"><pre><span class="lineno">1</span> <span class="n">package</span> <span class="p">{</span> <span class="s2">&quot;httpd&quot;</span><span class="p">:</span>
<span class="lineno">2</span>   <span class="n">ensure</span> <span class="o">=&gt;</span> <span class="n">present</span><span class="p">,</span>
<span class="lineno">3</span> <span class="p">}</span>
</pre></div>
</section>
          
        </div>
        <footer>
          
          <aside class="source">
            Source: <a href="file:///Users/oc/Dropbox/Shares/Roots 2011/roots-puppet/tutorial/slides.md">slides.md</a>
          </aside>
          
          <aside class="page_number">
            5/23
          </aside>
        </footer>
      </div>
      
      <!-- slide source: slides.md -->
      <div class="slide has_code">
        <div class="inner">
          
          <header><h1>Running puppet code</h1></header>
          
          
          <section><div class="highlight"><pre><span class="lineno">1</span> puppet apply myfile.pp
</pre></div>
</section>
          
        </div>
        <footer>
          
          <aside class="source">
            Source: <a href="file:///Users/oc/Dropbox/Shares/Roots 2011/roots-puppet/tutorial/slides.md">slides.md</a>
          </aside>
          
          <aside class="page_number">
            6/23
          </aside>
        </footer>
      </div>
      
      <!-- slide source: slides.md -->
      <div class="slide has_code">
        <div class="inner">
          
          <header><h1>Debugging puppet code</h1></header>
          
          
          <section><p>Master</p>
<div class="highlight"><pre><span class="lineno">1</span> puppetmasterd --no-deamonize
</pre></div>

<p>Agents (files)</p>
<div class="highlight"><pre><span class="lineno">1</span> puppet --debug --verbose file.pp
<span class="lineno">2</span> puppet --parseonly file.pp
</pre></div>

<p>Configurations</p>
<div class="highlight"><pre><span class="lineno">1</span> <span class="c1"># Notice the master log</span>
<span class="lineno">2</span> <span class="n">notice</span><span class="p">(</span><span class="s2">&quot;The value is: ${yourvar}&quot;</span><span class="p">)</span>
<span class="lineno">3</span> 
<span class="lineno">4</span> <span class="c1"># Notify the clients</span>
<span class="lineno">5</span> <span class="n">notify</span><span class="p">{</span><span class="s2">&quot;The value is: ${yourvar}&quot;</span><span class="p">:</span> <span class="p">}</span>
</pre></div>
</section>
          
        </div>
        <footer>
          
          <aside class="source">
            Source: <a href="file:///Users/oc/Dropbox/Shares/Roots 2011/roots-puppet/tutorial/slides.md">slides.md</a>
          </aside>
          
          <aside class="page_number">
            7/23
          </aside>
        </footer>
      </div>
      
      <!-- slide source: slides.md -->
      <div class="slide has_code">
        <div class="inner">
          
          <header><h1>Different resource types</h1></header>
          
          
          <section><div class="highlight"><pre><span class="lineno"> 1</span> <span class="n">group</span> <span class="p">{</span> <span class="s2">&quot;staff&quot;</span><span class="p">:</span>
<span class="lineno"> 2</span>     <span class="n">ensure</span> <span class="o">=&gt;</span> <span class="n">present</span><span class="p">,</span>
<span class="lineno"> 3</span>     <span class="n">gid</span>    <span class="o">=&gt;</span> <span class="mi">10</span><span class="p">,</span>
<span class="lineno"> 4</span> <span class="p">}</span>
<span class="lineno"> 5</span> 
<span class="lineno"> 6</span> <span class="n">user</span> <span class="p">{</span> <span class="s2">&quot;oc&quot;</span><span class="p">:</span>
<span class="lineno"> 7</span>     <span class="n">ensure</span> <span class="o">=&gt;</span> <span class="n">present</span><span class="p">,</span>
<span class="lineno"> 8</span>     <span class="n">gid</span> <span class="o">=&gt;</span> <span class="mi">10</span><span class="p">,</span>
<span class="lineno"> 9</span>     <span class="n">uid</span> <span class="o">=&gt;</span> <span class="mi">1337</span><span class="p">,</span>
<span class="lineno">10</span>     <span class="n">home</span> <span class="o">=&gt;</span> <span class="s2">&quot;/home/oc&quot;</span><span class="p">,</span>
<span class="lineno">11</span>     <span class="n">managehome</span> <span class="o">=&gt;</span> <span class="kc">true</span><span class="p">,</span>
<span class="lineno">12</span> <span class="p">}</span>
<span class="lineno">13</span> 
<span class="lineno">14</span> <span class="n">cron</span> <span class="p">{</span> <span class="s2">&quot;poor-mans-http-ping&quot;</span><span class="p">:</span>
<span class="lineno">15</span>   <span class="n">command</span> <span class="o">=&gt;</span> <span class="s2">&quot;curl -s http://rootsconf.no/ &gt; /dev/null 2&gt;&amp;1&quot;</span><span class="p">,</span>
<span class="lineno">16</span>   <span class="n">user</span> <span class="o">=&gt;</span> <span class="s2">&quot;oc&quot;</span><span class="p">,</span>
<span class="lineno">17</span>   <span class="n">minute</span> <span class="o">=&gt;</span> <span class="s2">&quot;*/1&quot;</span><span class="p">,</span> <span class="c1"># Every minute</span>
<span class="lineno">18</span> <span class="p">}</span>
</pre></div>
</section>
          
        </div>
        <footer>
          
          <aside class="source">
            Source: <a href="file:///Users/oc/Dropbox/Shares/Roots 2011/roots-puppet/tutorial/slides.md">slides.md</a>
          </aside>
          
          <aside class="page_number">
            8/23
          </aside>
        </footer>
      </div>
      
      <!-- slide source: slides.md -->
      <div class="slide has_code">
        <div class="inner">
          
          <header><h1>Generic resource types</h1></header>
          
          
          <section><p>Building blocks for describing resources not directly supported.</p>
<div class="highlight"><pre><span class="lineno">1</span> <span class="n">file</span> <span class="p">{</span> <span class="s2">&quot;/etc/localtime&quot;</span><span class="p">:</span>
<span class="lineno">2</span>   <span class="n">ensure</span> <span class="o">=&gt;</span> <span class="n">link</span><span class="p">,</span>
<span class="lineno">3</span>   <span class="n">target</span> <span class="o">=&gt;</span> <span class="s2">&quot;/usr/share/zoneinfo/Europe/Oslo&quot;</span><span class="p">,</span>
<span class="lineno">4</span> <span class="p">}</span>
</pre></div>
</section>
          
        </div>
        <footer>
          
          <aside class="source">
            Source: <a href="file:///Users/oc/Dropbox/Shares/Roots 2011/roots-puppet/tutorial/slides.md">slides.md</a>
          </aside>
          
          <aside class="page_number">
            9/23
          </aside>
        </footer>
      </div>
      
      <!-- slide source: slides.md -->
      <div class="slide has_code">
        <div class="inner">
          
          <header><h1>Dependencies between resources</h1></header>
          
          
          <section><p><code>require</code> / <code>before</code> and <code>notify</code> / <code>subsribe</code>.</p>
<div class="highlight"><pre><span class="lineno"> 1</span> <span class="nv">$nexus_bundle</span> <span class="o">=</span> <span class="s2">&quot;/tmp/nexus-oss-webapp-1.9.1.1-bundle.tar.gz&quot;</span>
<span class="lineno"> 2</span> 
<span class="lineno"> 3</span> <span class="n">file</span> <span class="p">{</span> <span class="s2">&quot;/opt/nexus-oss-webapp-1.9.1.1&quot;</span><span class="p">:</span>
<span class="lineno"> 4</span>   <span class="n">require</span> <span class="o">=&gt;</span> <span class="n">Exec</span><span class="p">[</span><span class="s2">&quot;Extract nexus&quot;</span><span class="p">],</span>
<span class="lineno"> 5</span> <span class="p">}</span>
<span class="lineno"> 6</span> 
<span class="lineno"> 7</span> <span class="n">exec</span> <span class="p">{</span> <span class="s2">&quot;Extract nexus&quot;</span><span class="p">:</span>
<span class="lineno"> 8</span>   <span class="n">cwd</span>     <span class="o">=&gt;</span> <span class="s2">&quot;/opt&quot;</span><span class="p">,</span>
<span class="lineno"> 9</span>   <span class="n">command</span> <span class="o">=&gt;</span> <span class="s2">&quot;tar xvf $nexus_bundle&quot;</span><span class="p">,</span>
<span class="lineno">10</span>   <span class="n">creates</span> <span class="o">=&gt;</span> <span class="s1">&#39;/opt/nexus-oss-webapp-1.9.1.1&#39;</span><span class="p">,</span>
<span class="lineno">11</span>   <span class="n">path</span>    <span class="o">=&gt;</span> <span class="s2">&quot;/usr/bin:/bin&quot;</span><span class="p">,</span>
<span class="lineno">12</span>   <span class="n">require</span> <span class="o">=&gt;</span> <span class="n">Exec</span><span class="p">[</span><span class="s2">&quot;Fetch nexus&quot;</span><span class="p">],</span>
<span class="lineno">13</span> <span class="p">}</span>
<span class="lineno">14</span> 
<span class="lineno">15</span> <span class="n">exec</span> <span class="p">{</span> <span class="s2">&quot;Fetch nexus&quot;</span><span class="p">:</span>
<span class="lineno">16</span>   <span class="n">cwd</span>     <span class="o">=&gt;</span> <span class="s2">&quot;/tmp&quot;</span><span class="p">,</span>
<span class="lineno">17</span>   <span class="n">command</span> <span class="o">=&gt;</span> <span class="s2">&quot;curl -O $nexus_url&quot;</span><span class="p">,</span>
<span class="lineno">18</span>   <span class="n">creates</span> <span class="o">=&gt;</span> <span class="nv">$nexus_bundle</span><span class="p">,</span>
<span class="lineno">19</span>   <span class="n">path</span>    <span class="o">=&gt;</span> <span class="s2">&quot;/usr/bin:/bin&quot;</span><span class="p">,</span>
<span class="lineno">20</span>   <span class="n">require</span> <span class="o">=&gt;</span> <span class="n">Package</span><span class="p">[</span><span class="s2">&quot;curl&quot;</span><span class="p">],</span>
<span class="lineno">21</span> <span class="p">}</span>
</pre></div>
</section>
          
        </div>
        <footer>
          
          <aside class="source">
            Source: <a href="file:///Users/oc/Dropbox/Shares/Roots 2011/roots-puppet/tutorial/slides.md">slides.md</a>
          </aside>
          
          <aside class="page_number">
            10/23
          </aside>
        </footer>
      </div>
      
      <!-- slide source: slides.md -->
      <div class="slide has_code">
        <div class="inner">
          
          <header><h1>Templates and variables</h1></header>
          
          
          <section><div class="highlight"><pre><span class="lineno"> 1</span> <span class="nv">$port</span> <span class="o">=</span> <span class="mi">20202</span>
<span class="lineno"> 2</span> <span class="nv">$allowed_users</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;oc&quot;</span><span class="p">,</span> <span class="s2">&quot;stein&quot;</span><span class="p">,</span> <span class="s2">&quot;root&quot;</span><span class="p">]</span> <span class="c1"># shouldn&#39;t really allow root</span>
<span class="lineno"> 3</span> 
<span class="lineno"> 4</span> <span class="n">package</span> <span class="p">{</span> <span class="s2">&quot;sshd&quot;</span><span class="p">:</span>
<span class="lineno"> 5</span>   <span class="n">ensure</span> <span class="o">=&gt;</span> <span class="n">present</span><span class="p">,</span>
<span class="lineno"> 6</span> <span class="p">}</span>
<span class="lineno"> 7</span> 
<span class="lineno"> 8</span> <span class="n">file</span> <span class="p">{</span> <span class="s2">&quot;/etc/ssh/sshd_config&quot;</span><span class="p">:</span>
<span class="lineno"> 9</span>   <span class="n">content</span> <span class="o">=&gt;</span> <span class="n">template</span><span class="p">(</span><span class="s2">&quot;sshd_config.erb&quot;</span><span class="p">),</span>
<span class="lineno">10</span>   <span class="n">require</span> <span class="o">=&gt;</span> <span class="n">Package</span><span class="p">[</span><span class="s2">&quot;sshd&quot;</span><span class="p">],</span>
<span class="lineno">11</span> <span class="p">}</span>
<span class="lineno">12</span> 
<span class="lineno">13</span> <span class="n">service</span> <span class="p">{</span> <span class="n">ssh</span><span class="p">:</span>
<span class="lineno">14</span>   <span class="n">ensure</span> <span class="o">=&gt;</span> <span class="n">running</span><span class="p">,</span>
<span class="lineno">15</span>   <span class="n">enable</span> <span class="o">=&gt;</span> <span class="kc">true</span><span class="p">,</span>
<span class="lineno">16</span>   <span class="n">hasstatus</span> <span class="o">=&gt;</span> <span class="kc">true</span><span class="p">,</span>
<span class="lineno">17</span>   <span class="n">subscribe</span> <span class="o">=&gt;</span> <span class="p">[</span> <span class="n">Package</span><span class="p">[</span><span class="s2">&quot;sshd&quot;</span><span class="p">],</span> <span class="n">File</span><span class="p">[</span><span class="s2">&quot;/etc/ssh/sshd_config&quot;</span><span class="p">]</span> <span class="p">],</span>
<span class="lineno">18</span> <span class="p">}</span>
</pre></div>
</section>
          
        </div>
        <footer>
          
          <aside class="source">
            Source: <a href="file:///Users/oc/Dropbox/Shares/Roots 2011/roots-puppet/tutorial/slides.md">slides.md</a>
          </aside>
          
          <aside class="page_number">
            11/23
          </aside>
        </footer>
      </div>
      
      <!-- slide source: slides.md -->
      <div class="slide has_code">
        <div class="inner">
          
          
          <section><p><code>sshd_config.erb</code>:</p>
<div class="highlight"><pre><span class="lineno"> 1</span> <span class="x">Port </span><span class="cp">&lt;%=</span> <span class="n">port</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="lineno"> 2</span> 
<span class="lineno"> 3</span> <span class="x">Protocol 2</span>
<span class="lineno"> 4</span> <span class="x">HostKey /etc/ssh/ssh_host_rsa_key</span>
<span class="lineno"> 5</span> <span class="x">HostKey /etc/ssh/ssh_host_dsa_key</span>
<span class="lineno"> 6</span> <span class="x">UsePrivilegeSeparation yes</span>
<span class="lineno"> 7</span> 
<span class="lineno"> 8</span> <span class="x">KeyRegenerationInterval 3600</span>
<span class="lineno"> 9</span> <span class="x">ServerKeyBits 768</span>
<span class="lineno">10</span> 
<span class="lineno">11</span> <span class="x">LoginGraceTime 120</span>
<span class="lineno">12</span> <span class="x">PermitRootLogin yes # Should be set to &#39;no&#39;</span>
<span class="lineno">13</span> <span class="x">StrictModes yes</span>
<span class="lineno">14</span> 
<span class="lineno">15</span> <span class="x">PubkeyAuthentication yes</span>
<span class="lineno">16</span> <span class="x">PasswordAuthentication yes # Should be set to &#39;no&#39;</span>
<span class="lineno">17</span> 
<span class="lineno">18</span> <span class="x">UsePAM yes</span>
<span class="lineno">19</span> 
<span class="lineno">20</span> <span class="cp">&lt;%</span> <span class="k">if</span> <span class="n">allowed_users</span><span class="o">.</span><span class="n">any?</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="lineno">21</span> <span class="x">AllowUsers </span><span class="cp">&lt;%=</span> <span class="n">allowed_users</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="lineno">22</span> <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span><span class="x"></span>
</pre></div>
</section>
          
        </div>
        <footer>
          
          <aside class="source">
            Source: <a href="file:///Users/oc/Dropbox/Shares/Roots 2011/roots-puppet/tutorial/slides.md">slides.md</a>
          </aside>
          
          <aside class="page_number">
            12/23
          </aside>
        </footer>
      </div>
      
      <!-- slide source: slides.md -->
      <div class="slide has_code">
        <div class="inner">
          
          <header><h1>Running puppet code with templates</h1></header>
          
          
          <section><div class="highlight"><pre><span class="lineno">1</span> puppet apply --templatedir<span class="o">=</span>templates templates_and_variables.pp
</pre></div>
</section>
          
        </div>
        <footer>
          
          <aside class="source">
            Source: <a href="file:///Users/oc/Dropbox/Shares/Roots 2011/roots-puppet/tutorial/slides.md">slides.md</a>
          </aside>
          
          <aside class="page_number">
            13/23
          </aside>
        </footer>
      </div>
      
      <!-- slide source: slides.md -->
      <div class="slide">
        <div class="inner">
          
          <header><h1>Modules</h1></header>
          
          
          <section><p>Collection of resources, classes, files, definitions and templates.</p>
<pre><code>modules/
    nginx/
      manifests/
        init.pp
      files/
        nginx.conf
      templates/
        site.conf.erb
</code></pre></section>
          
        </div>
        <footer>
          
          <aside class="source">
            Source: <a href="file:///Users/oc/Dropbox/Shares/Roots 2011/roots-puppet/tutorial/slides.md">slides.md</a>
          </aside>
          
          <aside class="page_number">
            14/23
          </aside>
        </footer>
      </div>
      
      <!-- slide source: slides.md -->
      <div class="slide has_code">
        <div class="inner">
          
          <header><h1>Classes</h1></header>
          
          
          <section><p>Collection of resources. Not like the OOP term.</p>
<p><code>modules/nginx/manifests/init.pp</code>:</p>
<div class="highlight"><pre><span class="lineno"> 1</span> <span class="k">class</span> <span class="n">nginx</span> <span class="p">{</span>
<span class="lineno"> 2</span>   <span class="n">package</span> <span class="p">{</span> <span class="n">nginx</span><span class="p">:</span>
<span class="lineno"> 3</span>     <span class="n">ensure</span> <span class="o">=&gt;</span> <span class="n">present</span><span class="p">,</span>
<span class="lineno"> 4</span>   <span class="p">}</span>
<span class="lineno"> 5</span> 
<span class="lineno"> 6</span>   <span class="n">file</span> <span class="p">{</span> <span class="s2">&quot;/var/www&quot;</span><span class="p">:</span>
<span class="lineno"> 7</span>     <span class="n">ensure</span> <span class="o">=&gt;</span> <span class="n">directory</span><span class="p">,</span>
<span class="lineno"> 8</span>   <span class="p">}</span>
<span class="lineno"> 9</span> 
<span class="lineno">10</span>   <span class="n">file</span> <span class="p">{</span> <span class="s2">&quot;/etc/nginx/nginx.conf&quot;</span><span class="p">:</span>
<span class="lineno">11</span>     <span class="n">source</span> <span class="o">=&gt;</span> <span class="s2">&quot;puppet:///modules/nginx/nginx.conf&quot;</span><span class="p">,</span>
<span class="lineno">12</span>     <span class="n">require</span> <span class="o">=&gt;</span> <span class="n">Package</span><span class="p">[</span><span class="n">nginx</span><span class="p">],</span>
<span class="lineno">13</span>   <span class="p">}</span>
<span class="lineno">14</span> 
<span class="lineno">15</span>   <span class="n">service</span> <span class="p">{</span> <span class="n">nginx</span><span class="p">:</span>
<span class="lineno">16</span>     <span class="n">ensure</span> <span class="o">=&gt;</span> <span class="n">running</span><span class="p">,</span>
<span class="lineno">17</span>     <span class="n">enable</span> <span class="o">=&gt;</span> <span class="kc">true</span><span class="p">,</span>
<span class="lineno">18</span>     <span class="n">pattern</span> <span class="o">=&gt;</span> <span class="s2">&quot;nginx: master process&quot;</span><span class="p">,</span>
<span class="lineno">19</span>     <span class="n">subscribe</span> <span class="o">=&gt;</span> <span class="n">File</span><span class="p">[</span><span class="s2">&quot;/etc/nginx/nginx.conf&quot;</span><span class="p">],</span>
<span class="lineno">20</span>     <span class="n">require</span> <span class="o">=&gt;</span> <span class="n">File</span><span class="p">[</span><span class="s2">&quot;/etc/nginx/nginx.conf&quot;</span><span class="p">],</span>
<span class="lineno">21</span>   <span class="p">}</span>
<span class="lineno">22</span> <span class="p">}</span>
</pre></div>
</section>
          
        </div>
        <footer>
          
          <aside class="source">
            Source: <a href="file:///Users/oc/Dropbox/Shares/Roots 2011/roots-puppet/tutorial/slides.md">slides.md</a>
          </aside>
          
          <aside class="page_number">
            15/23
          </aside>
        </footer>
      </div>
      
      <!-- slide source: slides.md -->
      <div class="slide has_code">
        <div class="inner">
          
          <header><h1>Applying modules</h1></header>
          
          
          <section><div class="highlight"><pre><span class="lineno">1</span> puppet apply --modulepath<span class="o">=</span>modules -e <span class="s1">&#39;include nginx&#39;</span>
</pre></div>
</section>
          
        </div>
        <footer>
          
          <aside class="source">
            Source: <a href="file:///Users/oc/Dropbox/Shares/Roots 2011/roots-puppet/tutorial/slides.md">slides.md</a>
          </aside>
          
          <aside class="page_number">
            16/23
          </aside>
        </footer>
      </div>
      
      <!-- slide source: slides.md -->
      <div class="slide has_code">
        <div class="inner">
          
          <header><h1>Definitions</h1></header>
          
          
          <section><p>Create new resource types.</p>
<div class="highlight"><pre><span class="lineno"> 1</span> <span class="k">define</span> <span class="n">nginx</span><span class="p">::</span><span class="n">site</span><span class="p">(</span><span class="nv">$domain</span><span class="p">,</span> <span class="nv">$root</span><span class="p">)</span> <span class="p">{</span>
<span class="lineno"> 2</span> 
<span class="lineno"> 3</span>   <span class="n">file</span> <span class="p">{</span> <span class="nv">$root:</span>
<span class="lineno"> 4</span>     <span class="n">ensure</span> <span class="o">=&gt;</span> <span class="n">directory</span><span class="p">,</span>
<span class="lineno"> 5</span>   <span class="p">}</span>
<span class="lineno"> 6</span> 
<span class="lineno"> 7</span>   <span class="n">file</span> <span class="p">{</span> <span class="s2">&quot;/etc/nginx/sites-available/${name}.conf&quot;</span><span class="p">:</span>
<span class="lineno"> 8</span>     <span class="n">ensure</span> <span class="o">=&gt;</span> <span class="n">present</span><span class="p">,</span>
<span class="lineno"> 9</span>     <span class="n">content</span> <span class="o">=&gt;</span> <span class="n">template</span><span class="p">(</span><span class="s2">&quot;nginx/site.conf.erb&quot;</span><span class="p">),</span>
<span class="lineno">10</span>     <span class="n">require</span> <span class="o">=&gt;</span> <span class="n">File</span><span class="p">[</span><span class="nv">$root</span><span class="p">],</span>
<span class="lineno">11</span>     <span class="n">notify</span> <span class="o">=&gt;</span> <span class="n">Service</span><span class="p">[</span><span class="n">nginx</span><span class="p">],</span>
<span class="lineno">12</span>   <span class="p">}</span>
<span class="lineno">13</span> 
<span class="lineno">14</span>   <span class="n">file</span> <span class="p">{</span> <span class="s2">&quot;/etc/nginx/sites-enabled/${name}.conf&quot;</span><span class="p">:</span>
<span class="lineno">15</span>     <span class="n">ensure</span> <span class="o">=&gt;</span> <span class="n">link</span><span class="p">,</span>
<span class="lineno">16</span>     <span class="n">target</span> <span class="o">=&gt;</span> <span class="s2">&quot;/etc/nginx/sites-available/${name}.conf&quot;</span><span class="p">,</span>
<span class="lineno">17</span>     <span class="n">require</span> <span class="o">=&gt;</span> <span class="n">File</span><span class="p">[</span><span class="s2">&quot;/etc/nginx/sites-available/${name}.conf&quot;</span><span class="p">],</span>
<span class="lineno">18</span>     <span class="n">notify</span> <span class="o">=&gt;</span> <span class="n">Service</span><span class="p">[</span><span class="n">nginx</span><span class="p">],</span>
<span class="lineno">19</span>   <span class="p">}</span>
<span class="lineno">20</span> 
<span class="lineno">21</span> <span class="p">}</span>
</pre></div>
</section>
          
        </div>
        <footer>
          
          <aside class="source">
            Source: <a href="file:///Users/oc/Dropbox/Shares/Roots 2011/roots-puppet/tutorial/slides.md">slides.md</a>
          </aside>
          
          <aside class="page_number">
            17/23
          </aside>
        </footer>
      </div>
      
      <!-- slide source: slides.md -->
      <div class="slide has_code">
        <div class="inner">
          
          
          <section><p><code>site.conf.erb</code> for nginx::site resource:</p>
<div class="highlight"><pre><span class="lineno"> 1</span> <span class="x">server {</span>
<span class="lineno"> 2</span> <span class="x">  listen 80;</span>
<span class="lineno"> 3</span> <span class="x">  server_name </span><span class="cp">&lt;%=</span> <span class="n">domain</span> <span class="cp">%&gt;</span><span class="x">;</span>
<span class="lineno"> 4</span> 
<span class="lineno"> 5</span> <span class="x">  access_log  /var/log/nginx/</span><span class="cp">&lt;%=</span> <span class="nb">name</span> <span class="cp">%&gt;</span><span class="x">.access.log;</span>
<span class="lineno"> 6</span> 
<span class="lineno"> 7</span> <span class="x">  location / {</span>
<span class="lineno"> 8</span> <span class="x">    root </span><span class="cp">&lt;%=</span> <span class="n">root</span> <span class="cp">%&gt;</span><span class="x">;</span>
<span class="lineno"> 9</span> <span class="x">    index  index.html;</span>
<span class="lineno">10</span> <span class="x">  }</span>
<span class="lineno">11</span> <span class="x">}</span>
</pre></div>
</section>
          
        </div>
        <footer>
          
          <aside class="source">
            Source: <a href="file:///Users/oc/Dropbox/Shares/Roots 2011/roots-puppet/tutorial/slides.md">slides.md</a>
          </aside>
          
          <aside class="page_number">
            18/23
          </aside>
        </footer>
      </div>
      
      <!-- slide source: slides.md -->
      <div class="slide has_code">
        <div class="inner">
          
          <header><h1>Nodes</h1></header>
          
          
          <section><p>Uses classes and invokes definitions from modules.</p>
<pre><code>manifests/
  nodes.pp
  site.pp
modules/
    nginx/
</code></pre>
<p><code>manifests/nodes.pp</code>:</p>
<div class="highlight"><pre><span class="lineno"> 1</span> <span class="k">node</span> <span class="k">default</span> <span class="p">{</span>
<span class="lineno"> 2</span>   <span class="kn">include</span> <span class="n">ssh</span>
<span class="lineno"> 3</span>   <span class="kn">include</span> <span class="n">git</span>
<span class="lineno"> 4</span>   <span class="kn">include</span> <span class="n">timezone</span>
<span class="lineno"> 5</span>   <span class="kn">include</span> <span class="n">java</span><span class="p">::</span><span class="n">oracle</span>
<span class="lineno"> 6</span> <span class="p">}</span>
<span class="lineno"> 7</span> 
<span class="lineno"> 8</span> <span class="k">node</span> <span class="s2">&quot;mgmt.muda.no&quot;</span> <span class="k">inherits</span> <span class="k">default</span><span class="n">s</span> <span class="p">{</span>
<span class="lineno"> 9</span>   <span class="kn">include</span> <span class="n">puppet</span><span class="p">::</span><span class="n">master</span>
<span class="lineno">10</span>   <span class="kn">include</span> <span class="n">sonatype</span><span class="p">::</span><span class="n">nexus</span>
<span class="lineno">11</span> <span class="p">}</span>
</pre></div>
</section>
          
        </div>
        <footer>
          
          <aside class="source">
            Source: <a href="file:///Users/oc/Dropbox/Shares/Roots 2011/roots-puppet/tutorial/slides.md">slides.md</a>
          </aside>
          
          <aside class="page_number">
            19/23
          </aside>
        </footer>
      </div>
      
      <!-- slide source: slides.md -->
      <div class="slide">
        <div class="inner">
          
          <header><h1>Typical setup (client-server)</h1></header>
          
          
          <section><ul>
<li>One Puppet master</li>
<li>Many Puppet agents which pulls the Puppet master for changes over a REST API</li>
<li>SSL certificate based authentication &mdash; agents needs to get signed
  on the master</li>
</ul>
<p>The agents does not have access to the source configuration:</p>
<ol>
<li>The agent gathers local facts about its system</li>
<li>The agent requests a configuration catalog from the master</li>
<li>The master compiles the source configuration to a catalog and returns it to the agent</li>
<li>The agent applies the catalog which results in configuration changes</li>
</ol></section>
          
        </div>
        <footer>
          
          <aside class="source">
            Source: <a href="file:///Users/oc/Dropbox/Shares/Roots 2011/roots-puppet/tutorial/slides.md">slides.md</a>
          </aside>
          
          <aside class="page_number">
            20/23
          </aside>
        </footer>
      </div>
      
      <!-- slide source: slides.md -->
      <div class="slide">
        <div class="inner">
          
          <header><h1>More</h1></header>
          
          
          <section><ul>
<li>Control structures (if, case)</li>
<li>Ruby plugins for creating new functions or resource types</li>
<li>Facter &mdash; gathers information from the host system &mdash;
  can be extended</li>
<li>Virtual resources.</li>
<li>Exported resources.</li>
<li>Separate environments (development, staging, production)</li>
</ul></section>
          
        </div>
        <footer>
          
          <aside class="source">
            Source: <a href="file:///Users/oc/Dropbox/Shares/Roots 2011/roots-puppet/tutorial/slides.md">slides.md</a>
          </aside>
          
          <aside class="page_number">
            21/23
          </aside>
        </footer>
      </div>
      
      <!-- slide source: slides.md -->
      <div class="slide">
        <div class="inner">
          
          <header><h1>Alternatives</h1></header>
          
          
          <section><ul>
<li>Cfengine</li>
<li>Chef</li>
</ul>
<p>Reasons to use Puppet in stead of Chef:</p>
<ul>
<li>Bootstrap is easy: <code>yum install puppet</code></li>
<li>Restricted language makes you think through what you need to do
  and makes it hard to create quick hacks.</li>
<li>A client&mdash;server installation is more lightweight (Chef needs
  RabbitMQ, CouchDB, Solr)</li>
</ul>
<p>Cfengine</p>
<ul>
<li>If you're into compile issues.</li>
</ul></section>
          
        </div>
        <footer>
          
          <aside class="source">
            Source: <a href="file:///Users/oc/Dropbox/Shares/Roots 2011/roots-puppet/tutorial/slides.md">slides.md</a>
          </aside>
          
          <aside class="page_number">
            22/23
          </aside>
        </footer>
      </div>
      
      <!-- slide source: slides.md -->
      <div class="slide">
        <div class="inner">
          
          <header><h1>Examples from the configuration</h1></header>
          
          
          <section><p>4 Linode VPS instances (mgmt, node1, node2, db1)</p>
<h2>Basic</h2>
<p>yum, puppet agent, puppet-master, Users, SSH, Network, NTP, timezone, UFW, git</p>
<h2>Servers</h2>
<p>apache, mysql, java, nexus</p></section>
          
        </div>
        <footer>
          
          <aside class="source">
            Source: <a href="file:///Users/oc/Dropbox/Shares/Roots 2011/roots-puppet/tutorial/slides.md">slides.md</a>
          </aside>
          
          <aside class="page_number">
            23/23
          </aside>
        </footer>
      </div>
      
    </div>
  </div>
  
  <div id="toc" class="sidebar hidden">
    <h2>Table of Contents</h2>
    <table>
      <caption>Table of Contents</caption>
            
      <tr id="toc-row-1">
        <th><a href="#slide1">Declarative Configuration Management with&nbsp;Puppet</a></th>
        <td><a href="#slide1">1</a></td>
      </tr>
      
            
      <tr id="toc-row-3">
        <th><a href="#slide3">Users</a></th>
        <td><a href="#slide3">3</a></td>
      </tr>
      
            
      <tr id="toc-row-4">
        <th><a href="#slide4">Preparation</a></th>
        <td><a href="#slide4">4</a></td>
      </tr>
      
            
      <tr id="toc-row-5">
        <th><a href="#slide5">Resources</a></th>
        <td><a href="#slide5">5</a></td>
      </tr>
      
            
      <tr id="toc-row-6">
        <th><a href="#slide6">Running puppet code</a></th>
        <td><a href="#slide6">6</a></td>
      </tr>
      
            
      <tr id="toc-row-7">
        <th><a href="#slide7">Debugging puppet code</a></th>
        <td><a href="#slide7">7</a></td>
      </tr>
      
            
      <tr id="toc-row-8">
        <th><a href="#slide8">Different resource types</a></th>
        <td><a href="#slide8">8</a></td>
      </tr>
      
            
      <tr id="toc-row-9">
        <th><a href="#slide9">Generic resource types</a></th>
        <td><a href="#slide9">9</a></td>
      </tr>
      
            
      <tr id="toc-row-10">
        <th><a href="#slide10">Dependencies between resources</a></th>
        <td><a href="#slide10">10</a></td>
      </tr>
      
            
      <tr id="toc-row-11">
        <th><a href="#slide11">Templates and variables</a></th>
        <td><a href="#slide11">11</a></td>
      </tr>
      
            
      <tr id="toc-row-13">
        <th><a href="#slide13">Running puppet code with templates</a></th>
        <td><a href="#slide13">13</a></td>
      </tr>
      
            
      <tr id="toc-row-14">
        <th><a href="#slide14">Modules</a></th>
        <td><a href="#slide14">14</a></td>
      </tr>
      
            
      <tr id="toc-row-15">
        <th><a href="#slide15">Classes</a></th>
        <td><a href="#slide15">15</a></td>
      </tr>
      
            
      <tr id="toc-row-16">
        <th><a href="#slide16">Applying modules</a></th>
        <td><a href="#slide16">16</a></td>
      </tr>
      
            
      <tr id="toc-row-17">
        <th><a href="#slide17">Definitions</a></th>
        <td><a href="#slide17">17</a></td>
      </tr>
      
            
      <tr id="toc-row-19">
        <th><a href="#slide19">Nodes</a></th>
        <td><a href="#slide19">19</a></td>
      </tr>
      
            
      <tr id="toc-row-20">
        <th><a href="#slide20">Typical setup (client-server)</a></th>
        <td><a href="#slide20">20</a></td>
      </tr>
      
            
      <tr id="toc-row-21">
        <th><a href="#slide21">More</a></th>
        <td><a href="#slide21">21</a></td>
      </tr>
      
            
      <tr id="toc-row-22">
        <th><a href="#slide22">Alternatives</a></th>
        <td><a href="#slide22">22</a></td>
      </tr>
      
            
      <tr id="toc-row-23">
        <th><a href="#slide23">Examples from the configuration</a></th>
        <td><a href="#slide23">23</a></td>
      </tr>
      
      
    </table>
  </div>
  
  <div id="help" class="sidebar hidden">
    <h2>Help</h2>
    <table>
      <caption>Help</caption>
      <tr>
        <th>Table of Contents</th>
        <td>t</td>
      </tr>
      <tr>
        <th>Source Files</th>
        <td>s</td>
      </tr>
      <tr>
        <th>Slide Numbers</th>
        <td>n</td>
      </tr>
      <tr>
        <th>Notes</th>
        <td>2</td>
      </tr>
      <tr>
        <th>Help</th>
        <td>h</td>
      </tr>
    </table>
  </div>
  <script>main()</script>
</body>
</html>